---
title: 2019-02-22-rice-geographic-italy
author: ~
date: '2019-02-22'
slug: rice-geographic-italy
categories: []
tags: []
image:
  caption: ''
  focal_point: ''
output:
  blogdown::html_page:
    toc: true
    toc_depth: 2
    number_sections: true
    dev: svglite
    css: ../custom.css
editor_options: 
  chunk_output_type: console
---

```{r, echo = FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
```


# Rice in Italy

It has been a while that, for work and personal interest, I wanted to explore the details of rice production in Italy. 

In northern Italy, rice is a very important crop and food.
It is well integrated in our culinary traditions, and it [has been bred and grown here for centuries](https://www.enterisi.it/servizi/Menu/dinamica.aspx?idSezione=17299&idArea=17395&idCat=17304&ID=17304&TipoElemento=categoria).
When thinking of Italian food, wheat based pizza and pasta might be the first dishes that come to mind, but rice, especially but not only, in the form of risotto is an pivotal dish of these regions.
Rice was grown in northen Italy at least since the 15^th^ century. It was bred here, adapting it for [high latitude](https://doi.org/10.1093/jxb/erv004) and temperate growing conditions, and for our culinary tastes.

There are many aspects of italian rice that are worth exploring: its history, its genetic pools, the characterstics of the plant and of its grain and its part in Italian culinary tradition.
Here I decided to start from the **areas in which rice is cultivated**.

# Searching Open Data

To explore and quantify where rice is cultivated in Italy, I had to search for at least two kinds of data.

1. Data about agriculture, quantifying hom much land is dedicated to which culture, and hopefully how much rice they produce.
2. Geographical data, to aggregate  agricultural data on a map.

## Agricultural data from Regione Lombardia

[Lombardia](https://en.wikipedia.org/wiki/Lombardy) is the administrative region in Italy that has Milan as capital. It's where I'm living right now, and it's also one of the main rice producing regions

It turned out that this region maintains highly detailed datasets on its [open data website](https://www.dati.lombardia.it/), about many topics, including agriculture.

And when I say "higly detailed", I mean it. I was plotting some [shapefiles](https://en.wikipedia.org/wiki/Shapefile) to figure out what they stored, and I was puzzled when the resulting shape was a square. I realized that the square was one single farm/field. And the dataset that I was exploring contained the shapes and coordiantes of every agricultural field in Lombardia, together with what is cultivated on it!

For example, this is every area dedicated to agriculture/farming in Gaggiano, a municipality south west of Milan. (The image below is a screeshot of a leaflet app, [here you'll find the code to download the data and launch the interactive app](https://github.com/othomantegazza/lorice/blob/master/gaggiano.R).)

</p><img src="../_img/gaggiano.png" width="1000px"><p>

Associated to the shapefiles, [at the same website](https://www.dati.lombardia.it/) there is a [dataset that stores details of what's cultivated in each field](https://www.dati.lombardia.it/Agricoltura/Particelle-agricole-Provincia-di-Milano-dati-gener/8t7w-8tqw). With this dataset I could estimate, for each administrative area of Lombardia, how much land is dedicated to the rice production. 

I downloaded this dataset and summarized the area of land dedicated to rice production at the level of "municipality" (in Italian: "Comuni"), [here you can find the script for those steps](https://github.com/othomantegazza/lorice/blob/master/lombardy-rice-choropleth.R).

I wanted to visualize the area that is dedicated to rice production in each municipality of Lombardia with a [Choropleth map](https://en.wikipedia.org/wiki/Choropleth_map). But to do this, I needed a file with shapes and coordinates.

## Shapes of Italy on ISTAT

The Italian Institute for Statistics, ISTAT, [maintains shapefiles administrative areas at various administrative levels](https://www.istat.it/it/archivio/124086).

You can download and merge this dataset with the one that stores rice production [with this script (the same as above)](https://github.com/othomantegazza/lorice/blob/master/lombardy-rice-choropleth.R). In this script you can find also all the options and the details on how to launch the [leaflet app](https://rstudio.github.io/leaflet/) below.

Afterwards, we can open a leaflet app and plot the map of rice farming in Lombardy:

```{r}
library(tidyverse)
library(sf)
library(leaflet)
load("_data/lom_rice_shapes.Rdata") #content/post/
load("_data/lom_cloropleth_options.Rdata") # options for leaflet
```

```{r}

m_lom <- 
  leaflet() %>% 
  setView(lat = 45.6, ln = 9.7, zoom = 9) %>% 
  addTiles(urlTemplate = "//stamen-tiles-{s}.a.ssl.fastly.net/{variant}/{z}/{x}/{y}.{ext}",
           attribution = attribution,
           options = stamen_options) %>%
  addPolygons(data = lom_rice_shapes$geometry,
              fillColor = pal(lom_rice_shapes$rice_dens),
              stroke = TRUE,
              weight = 1,
              color = "#2D408F",
              fillOpacity = .8,
              label = labels,
              labelOptions = percent_label) %>% 
  addLegend(pal = pal,
            values = lom_rice_shapes$rice_dens,
            labFormat = labelFormat(prefix = "", suffix = "%",
                                    between = ", ",
                                    transform = function(x) {100 * x}),
            title = "Land dedicated<br>to Rice\nProduction",
            position = "bottomright")
```

```{r, out.width = "100%", echo=FALSE,  out.height="800px"}
m_lom
```

It looks like most of rice fields are located South-West of Lombardy. Indeed, the northern part of this region is mostly industrial and then mountainous. On the South-East there is some rice production, but it looks like most of farming is dedicated to different kinds of products, might be foraging grasses or corn (I'll have to check the details, maybe in another post). The South-West area, where rice is cultivated starts from Milan, and extends toward the city of Lodi, Pavia and mostly Vigevano and Mortara. Indeed most of rice productions seems to be concentrated in that parts of Lombardy that extends in that parts that protrudes like a horn in the nearby region of Piedmont.

Indeed, by the pattern in the map, it looks like rice production might estend well into Piedmont, the administrative region West of Lombardy. And it makes sense, since [Vercelli](https://en.wikipedia.org/wiki/Vercelli), the Piedmont city right next to the horn, is one of the main centers of Italian rice productions. 

But where to find open data about Piedmont?
 
```{r}
load("_data/rice-ente-shapes.Rdata")
```

```{r}

# Tokyo palettes with green shades
pal <- scico::scico(n = 100,
                    palette = "tokyo",
                    direction = -1) %>% colorNumeric(NULL)

# add an html label
labels <- sprintf(
  "<strong>%s</strong><br/>%g ha",
  rice_shapes$COMUNE, rice_shapes$acri
) %>% lapply(htmltools::HTML)


m <- 
  leaflet() %>% 
  setView(lat = 45.30, ln = 8.60, zoom = 10) %>% 
  # addTiles() %>%
  # addProviderTiles(providers$CartoDB.Positron) %>%
  # addProviderTiles(providers$Stamen.Toner) %>%
  addProviderTiles(providers$Stamen.TonerLite) %>%
  addPolygons(data = rice_shapes$geometry,
              fillColor = pal(rice_shapes$rice_dens),
              stroke = TRUE, weight = 2,
              # color = "#2D408F",
              color = "black",
              fillOpacity = .8,
              highlight = highlightOptions(
                weight = 5),
              label = labels,
              labelOptions = labelOptions(
                style = list("font-weight" = "normal", padding = "3px 8px"),
                textsize = "15px",
                direction = "auto")) 
```

```{r, out.width = "100%", echo=FALSE}
m
```

